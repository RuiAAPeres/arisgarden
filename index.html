<!DOCTYPE html>
<html lang="en">
  <head>
    <link
      rel="stylesheet"
      href="styles/main.css"
      type="text/css"
      media="screen"
    />
    <link
      rel="stylesheet"
      href="styles/common.css"
      type="text/css"
      media="screen"
    />
  </head>
  <body>
    <script src="scripts/common.js" type="text/javascript"></script>
    <script src="scripts/util.js" type="text/javascript"></script>
    <script src="scripts/recipes.js" type="text/javascript"></script>
    <script src="scripts/hyperapp.js" type="text/javascript"></script>
    <script src="scripts/db.js" type="text/javascript"></script>
    <div id="app"></div>

    <script>
      const { h, app } = hyperapp;
      window.h = h;
      window.app = app;

      var initState = {
        currentRecipe: db.recipes["pantry-dahl"],
        currentRecipeStep: 0,
        currentRecipeStepText: "",
        timer: null,
        timerRunning: false
      };

      const actions = {
        updateCurrentRecipeStep: (s, i) => ({ ...s, currentRecipeStep: i }),
        setTimer: (s, p) => ({
          ...s,
          timer: p.time,
          timerRunning: true,
          currentRecipeStepText: p.step
        }),

        cancelTimer: s => ({ ...s, timer: null, timerRunning: false }),
        countDown: (s, t) => {
          console.log("state is", s.timer);
          if (s.timer == 0) {
            return ({ ...s, timer: null, timerRunning: false });
          } else {
            return ({ ...s, timer: s.timer - 1 });
          }
        }
      };

      app({
        init: initState,
        view: state =>
          h("main", { style: { marginBottom: "128px" } }, [
            recipeView(state),
            v_Timer(state)
          ]),
        node: document.getElementById("app"),
        subscriptions: state => [
          state.timerRunning && interval(actions.countDown, { delay: 1000 })
        ]
      });
    </script>
  </body>
</html>
